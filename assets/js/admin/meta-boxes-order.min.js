jQuery(function(e){var o={states:null,init:function(){"undefined"!=typeof woocommerce_admin_meta_boxes_order&&"undefined"!=typeof woocommerce_admin_meta_boxes_order.countries&&(this.states=e.parseJSON(woocommerce_admin_meta_boxes_order.countries.replace(/&quot;/g,'"'))),e(".js_field-country").select2().change(this.change_country),e(".js_field-country").trigger("change",[!0]),e("body").on("change","select.js_field-state",this.change_state),e("#woocommerce-order-actions input, #woocommerce-order-actions a").click(function(){window.onbeforeunload=""}),e("a.edit_address").click(this.edit_address),e("button.billing-same-as-shipping").on("click",this.copy_billing_to_shipping),e("button.load_customer_billing").on("click",this.load_billing),e("button.load_customer_shipping").on("click",this.load_shipping)},change_country:function(t,i){if("undefined"==typeof i&&(i=!1),null!==o.states){var n=e(this),a=n.val(),c=n.parents(".edit_address").find(":input.js_field-state"),r=c.parent(),_=c.attr("name"),m=c.attr("id"),d=n.data("woocommerce.stickState-"+a)?n.data("woocommerce.stickState-"+a):c.val(),s=c.attr("placeholder");if(i&&n.data("woocommerce.stickState-"+a,d),r.show().find(".select2-container").remove(),e.isEmptyObject(o.states[a]))c.replaceWith('<input type="text" class="js_field-state" name="'+_+'" id="'+m+'" value="'+d+'" placeholder="'+s+'" />');else{var l=e('<select name="'+_+'" id="'+m+'" class="js_field-state select short" placeholder="'+s+'"></select>'),u=o.states[a];l.append(e('<option value="">'+woocommerce_admin_meta_boxes_order.i18n_select_state_text+"</option>")),e.each(u,function(o){l.append(e('<option value="'+o+'">'+u[o]+"</option>"))}),l.val(d),c.replaceWith(l),l.show().select2().hide().change()}e("body").trigger("contry-change.woocommerce",[a,e(this).closest("div")])}},change_state:function(){var o=e(this),t=o.val(),i=o.parents(".edit_address").find(":input.js_field-country"),n=i.val();i.data("woocommerce.stickState-"+n,t)},init_tiptip:function(){e("#tiptip_holder").removeAttr("style"),e("#tiptip_arrow").removeAttr("style"),e(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},edit_address:function(o){o.preventDefault(),e(this).hide(),e(this).closest(".order_data_column").find("div.address").hide(),e(this).closest(".order_data_column").find("div.edit_address").show()},load_billing:function(){if(window.confirm(woocommerce_admin_meta_boxes.load_billing)){var o=e("#customer_user").val();if(!o)return window.alert(woocommerce_admin_meta_boxes.no_customer_selected),!1;var t={user_id:o,type_to_load:"billing",action:"woocommerce_get_customer_details",security:woocommerce_admin_meta_boxes.get_customer_details_nonce};e(this).closest(".edit_address").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:t,type:"POST",success:function(o){var t=o;t&&(e("input#_billing_first_name").val(t.billing_first_name).change(),e("input#_billing_last_name").val(t.billing_last_name).change(),e("input#_billing_company").val(t.billing_company).change(),e("input#_billing_address_1").val(t.billing_address_1).change(),e("input#_billing_address_2").val(t.billing_address_2).change(),e("input#_billing_city").val(t.billing_city).change(),e("input#_billing_postcode").val(t.billing_postcode).change(),e("#_billing_country").val(t.billing_country).change(),e("#_billing_state").val(t.billing_state).change(),e("input#_billing_email").val(t.billing_email).change(),e("input#_billing_phone").val(t.billing_phone).change()),e(".edit_address").unblock()}})}return!1},load_shipping:function(){if(window.confirm(woocommerce_admin_meta_boxes.load_shipping)){var o=e("#customer_user").val();if(!o)return window.alert(woocommerce_admin_meta_boxes.no_customer_selected),!1;var t={user_id:o,type_to_load:"shipping",action:"woocommerce_get_customer_details",security:woocommerce_admin_meta_boxes.get_customer_details_nonce};e(this).closest(".edit_address").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:t,type:"POST",success:function(o){var t=o;t&&(e("input#_shipping_first_name").val(t.shipping_first_name).change(),e("input#_shipping_last_name").val(t.shipping_last_name).change(),e("input#_shipping_company").val(t.shipping_company).change(),e("input#_shipping_address_1").val(t.shipping_address_1).change(),e("input#_shipping_address_2").val(t.shipping_address_2).change(),e("input#_shipping_city").val(t.shipping_city).change(),e("input#_shipping_postcode").val(t.shipping_postcode).change(),e("#_shipping_country").val(t.shipping_country).change(),e("#_shipping_state").val(t.shipping_state).change()),e(".edit_address").unblock()}})}return!1},copy_billing_to_shipping:function(){return window.confirm(woocommerce_admin_meta_boxes.copy_billing)&&(e("input#_shipping_first_name").val(e("input#_billing_first_name").val()).change(),e("input#_shipping_last_name").val(e("input#_billing_last_name").val()).change(),e("input#_shipping_company").val(e("input#_billing_company").val()).change(),e("input#_shipping_address_1").val(e("input#_billing_address_1").val()).change(),e("input#_shipping_address_2").val(e("input#_billing_address_2").val()).change(),e("input#_shipping_city").val(e("input#_billing_city").val()).change(),e("input#_shipping_postcode").val(e("input#_billing_postcode").val()).change(),e("#_shipping_country").val(e("#_billing_country").val()).change(),e("#_shipping_state").val(e("#_billing_state").val()).change()),!1}},t={init:function(){this.stupidtable.init(),e("#woocommerce-order-items").on("click","button.add-line-item",this.add_line_item).on("click","button.refund-items",this.refund_items).on("click",".cancel-action",this.cancel).on("click","button.add-order-item",this.add_item).on("click","button.add-order-fee",this.add_fee).on("click","button.add-order-shipping",this.add_shipping).on("click","button.add-order-tax",this.add_tax).on("click","input.check-column",this.bulk_actions.check_column).on("click",".do_bulk_action",this.bulk_actions.do_bulk_action).on("click","button.calculate-action",this.calculate_totals).on("click","button.save-action",this.save_line_items).on("click","a.delete-order-tax",this.delete_tax).on("click","button.calculate-tax-action",this.calculate_tax).on("click","a.edit-order-item",this.edit_item).on("click","a.delete-order-item",this.delete_item).on("click",".delete_refund",this.refunds.delete_refund).on("click","button.do-api-refund, button.do-manual-refund",this.refunds.do_refund).on("change",".refund input.refund_line_total, .refund input.refund_line_tax",this.refunds.input_changed).on("change keyup",".wc-order-refund-items #refund_amount",this.refunds.amount_changed).on("change","input.refund_order_item_qty",this.refunds.refund_quantity_changed).on("change","input.quantity",this.quantity_changed).on("keyup",".woocommerce_order_items .split-input input:eq(0)",function(){var o=e(this).next();(""===o.val()||o.is(".match-total"))&&o.val(e(this).val()).addClass("match-total")}).on("keyup",".woocommerce_order_items .split-input input:eq(1)",function(){e(this).removeClass("match-total")}).on("click","button.add_order_item_meta",this.item_meta.add).on("click","button.remove_order_item_meta",this.item_meta.remove),e("body").on("wc_backbone_modal_loaded",this.backbone.init).on("wc_backbone_modal_response",this.backbone.response)},block:function(){e("#woocommerce-order-items").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){e("#woocommerce-order-items").unblock()},reload_items:function(){var i={order_id:woocommerce_admin_meta_boxes.post_id,action:"woocommerce_load_order_items",security:woocommerce_admin_meta_boxes.order_item_nonce};t.block(),e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:i,type:"POST",success:function(i){e("#woocommerce-order-items .inside").empty(),e("#woocommerce-order-items .inside").append(i),o.init_tiptip(),t.unblock(),t.stupidtable.init()}})},quantity_changed:function(){var o=e(this).closest("tr.item"),t=e(this).val(),i=e(this).attr("data-qty"),n=e("input.line_total",o),a=e("input.line_subtotal",o),c=accounting.unformat(n.attr("data-total"),woocommerce_admin.mon_decimal_point)/i;n.val(parseFloat(accounting.formatNumber(c*t,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point));var r=accounting.unformat(a.attr("data-subtotal"),woocommerce_admin.mon_decimal_point)/i;a.val(parseFloat(accounting.formatNumber(r*t,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point)),e("td.line_tax",o).each(function(){var o=e("input.line_tax",e(this)),n=accounting.unformat(o.attr("data-total_tax"),woocommerce_admin.mon_decimal_point)/i;n>0&&o.val(parseFloat(accounting.formatNumber(n*t,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point));var a=e("input.line_subtotal_tax",e(this)),c=accounting.unformat(a.attr("data-subtotal_tax"),woocommerce_admin.mon_decimal_point)/i;c>0&&a.val(parseFloat(accounting.formatNumber(c*t,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point))}),e(this).trigger("quantity_changed")},add_line_item:function(){return e("div.wc-order-add-item").slideDown(),e("div.wc-order-bulk-actions").slideUp(),!1},refund_items:function(){return e("div.wc-order-refund-items").slideDown(),e("div.wc-order-bulk-actions").slideUp(),e("div.wc-order-totals-items").slideUp(),e("#woocommerce-order-items div.refund").show(),e(".wc-order-edit-line-item .wc-order-edit-line-item-actions").hide(),!1},cancel:function(){return e(this).closest("div.wc-order-data-row").slideUp(),e("div.wc-order-bulk-actions").slideDown(),e("div.wc-order-totals-items").slideDown(),e("#woocommerce-order-items div.refund").hide(),e(".wc-order-edit-line-item .wc-order-edit-line-item-actions").show(),"true"===e(this).attr("data-reload")&&t.reload_items(),!1},add_item:function(){return e(this).WCBackboneModal({template:"#wc-modal-add-products"}),!1},add_fee:function(){t.block();var o={action:"woocommerce_add_order_fee",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce};return e.post(woocommerce_admin_meta_boxes.ajax_url,o,function(o){e("table.woocommerce_order_items tbody#order_fee_line_items").append(o),t.unblock()}),!1},add_shipping:function(){t.block();var o={action:"woocommerce_add_order_shipping",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce};return e.post(woocommerce_admin_meta_boxes.ajax_url,o,function(o){e("table.woocommerce_order_items tbody#order_shipping_line_items").append(o),t.unblock()}),!1},add_tax:function(){return e(this).WCBackboneModal({template:"#wc-modal-add-tax"}),!1},edit_item:function(){return e(this).closest("tr").find(".view").hide(),e(this).closest("tr").find(".edit").show(),e(this).hide(),e("button.add-line-item").click(),e("button.cancel-action").attr("data-reload",!0),!1},delete_item:function(){var o=window.confirm(woocommerce_admin_meta_boxes.remove_item_notice);if(o){var i=e(this).closest("tr.item, tr.fee, tr.shipping"),n=i.attr("data-order_item_id");t.block();var a={order_item_ids:n,action:"woocommerce_remove_order_item",security:woocommerce_admin_meta_boxes.order_item_nonce};e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:a,type:"POST",success:function(){i.remove(),t.unblock()}})}return!1},delete_tax:function(){if(window.confirm(woocommerce_admin_meta_boxes.i18n_delete_tax)){t.block();var i={action:"woocommerce_remove_order_tax",rate_id:e(this).attr("data-rate_id"),order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce};e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:i,type:"POST",success:function(i){e("#woocommerce-order-items .inside").empty(),e("#woocommerce-order-items .inside").append(i),o.init_tiptip(),t.unblock(),t.stupidtable.init()}})}return!1},calculate_tax:function(){if(window.confirm(woocommerce_admin_meta_boxes.calc_line_taxes)){t.block();var i=e("#_shipping_country").val(),n=e("#_billing_country").val(),a=woocommerce_admin_meta_boxes.base_country,c="",r="",_="";i?(a=i,c=e("#_shipping_state").val(),r=e("#_shipping_postcode").val(),_=e("#_shipping_city").val()):n&&(a=n,c=e("#_billing_state").val(),r=e("#_billing_postcode").val(),_=e("#_billing_city").val());var m={action:"woocommerce_calc_line_taxes",order_id:woocommerce_admin_meta_boxes.post_id,items:e("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize(),country:a,state:c,postcode:r,city:_,security:woocommerce_admin_meta_boxes.calc_totals_nonce};e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:m,type:"POST",success:function(i){e("#woocommerce-order-items .inside").empty(),e("#woocommerce-order-items .inside").append(i),o.init_tiptip(),t.unblock(),t.stupidtable.init()}})}return!1},calculate_totals:function(){if(window.confirm(woocommerce_admin_meta_boxes.calc_totals)){t.block();var o=0,i=0,n=0;e(".woocommerce_order_items tr.shipping input.line_total").each(function(){var o=e(this).val()||"0";o=accounting.unformat(o,woocommerce_admin.mon_decimal_point),n+=parseFloat(o)}),e(".woocommerce_order_items input.line_tax").each(function(){var o=e(this).val()||"0";o=accounting.unformat(o,woocommerce_admin.mon_decimal_point),i+=parseFloat(o)}),e(".woocommerce_order_items tr.item, .woocommerce_order_items tr.fee").each(function(){var t=e(this).find("input.line_total").val()||"0";o+=accounting.unformat(t.replace(",","."))}),"yes"===woocommerce_admin_meta_boxes.round_at_subtotal&&(i=parseFloat(accounting.toFixed(i,woocommerce_admin_meta_boxes.rounding_precision))),e("#_order_total").val(accounting.formatNumber(o+i+n,woocommerce_admin_meta_boxes.currency_format_num_decimals,"",woocommerce_admin.mon_decimal_point)).change(),e("button.save-action").click()}return!1},save_line_items:function(){var i={order_id:woocommerce_admin_meta_boxes.post_id,items:e("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize(),action:"woocommerce_save_order_items",security:woocommerce_admin_meta_boxes.order_item_nonce};return t.block(),e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:i,type:"POST",success:function(i){e("#woocommerce-order-items .inside").empty(),e("#woocommerce-order-items .inside").append(i),o.init_tiptip(),t.unblock(),t.stupidtable.init()}}),e(this).trigger("items_saved"),!1},refunds:{do_refund:function(){if(t.block(),window.confirm(woocommerce_admin_meta_boxes.i18n_do_refund)){var o=e("input#refund_amount").val(),i=e("input#refund_reason").val(),n={},a={},c={};e(".refund input.refund_order_item_qty").each(function(o,t){e(t).closest("tr").data("order_item_id")&&t.value&&(n[e(t).closest("tr").data("order_item_id")]=t.value)}),e(".refund input.refund_line_total").each(function(o,t){e(t).closest("tr").data("order_item_id")&&(a[e(t).closest("tr").data("order_item_id")]=accounting.unformat(t.value,woocommerce_admin.mon_decimal_point))}),e(".refund input.refund_line_tax").each(function(o,t){if(e(t).closest("tr").data("order_item_id")){var i=e(t).data("tax_id");c[e(t).closest("tr").data("order_item_id")]||(c[e(t).closest("tr").data("order_item_id")]={}),c[e(t).closest("tr").data("order_item_id")][i]=accounting.unformat(t.value,woocommerce_admin.mon_decimal_point)}});var r={action:"woocommerce_refund_line_items",order_id:woocommerce_admin_meta_boxes.post_id,refund_amount:o,refund_reason:i,line_item_qtys:JSON.stringify(n,null,""),line_item_totals:JSON.stringify(a,null,""),line_item_tax_totals:JSON.stringify(c,null,""),api_refund:e(this).is(".do-api-refund"),restock_refunded_items:e("#restock_refunded_items:checked").size()?"true":"false",security:woocommerce_admin_meta_boxes.order_item_nonce};e.post(woocommerce_admin_meta_boxes.ajax_url,r,function(e){!0===e.success?(t.reload_items(),"fully_refunded"===e.data.status&&(window.location.href=window.location.href)):(window.alert(e.data.error),t.unblock())})}else t.unblock()},delete_refund:function(){if(window.confirm(woocommerce_admin_meta_boxes.i18n_delete_refund)){var o=e(this).closest("tr.refund"),i=o.attr("data-order_refund_id");t.block();var n={action:"woocommerce_delete_refund",refund_id:i,security:woocommerce_admin_meta_boxes.order_item_nonce};e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:n,type:"POST",success:function(){t.reload_items()}})}return!1},input_changed:function(){var o=0,t=e(".woocommerce_order_items").find("tr.item, tr.fee, tr.shipping");t.each(function(){var t=e(this),i=t.find(".refund input:not(.refund_order_item_qty)");i.each(function(t,i){o+=parseFloat(accounting.unformat(e(i).val()||0,woocommerce_admin.mon_decimal_point))})}),e("#refund_amount").val(accounting.formatNumber(o,woocommerce_admin_meta_boxes.currency_format_num_decimals,"",woocommerce_admin.mon_decimal_point)).change()},amount_changed:function(){var o=accounting.unformat(e(this).val(),woocommerce_admin.mon_decimal_point);e("button .wc-order-refund-amount .amount").text(accounting.formatMoney(o,{symbol:woocommerce_admin_meta_boxes.currency_format_symbol,decimal:woocommerce_admin_meta_boxes.currency_format_decimal_sep,thousand:woocommerce_admin_meta_boxes.currency_format_thousand_sep,precision:woocommerce_admin_meta_boxes.currency_format_num_decimals,format:woocommerce_admin_meta_boxes.currency_format}))},refund_quantity_changed:function(){var o=e(this).closest("tr.item"),t=o.find("input.quantity").val(),i=e(this).val(),n=e("input.line_total",o),a=e("input.refund_line_total",o),c=accounting.unformat(n.attr("data-total"),woocommerce_admin.mon_decimal_point)/t;a.val(parseFloat(accounting.formatNumber(c*i,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point)).change(),e("td.line_tax",o).each(function(){var o=e("input.line_tax",e(this)),n=e("input.refund_line_tax",e(this)),a=accounting.unformat(o.attr("data-total_tax"),woocommerce_admin.mon_decimal_point)/t;a>0?n.val(parseFloat(accounting.formatNumber(a*i,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point)).change():n.val(0).change()}),i>0?e("#restock_refunded_items").closest("tr").show():(e("#restock_refunded_items").closest("tr").hide(),e(".woocommerce_order_items input.refund_order_item_qty").each(function(){e(this).val()>0&&e("#restock_refunded_items").closest("tr").show()})),e(this).trigger("refund_quantity_changed")}},item_meta:{add:function(){var o=e(this),i=o.closest("tr.item"),n={order_item_id:i.attr("data-order_item_id"),action:"woocommerce_add_order_item_meta",security:woocommerce_admin_meta_boxes.order_item_nonce};return t.block(),e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:n,type:"POST",success:function(e){i.find("tbody.meta_items").append(e),t.unblock()}}),!1},remove:function(){if(window.confirm(woocommerce_admin_meta_boxes.remove_item_meta)){var o=e(this).closest("tr"),i={meta_id:o.attr("data-meta_id"),action:"woocommerce_remove_order_item_meta",security:woocommerce_admin_meta_boxes.order_item_nonce};t.block(),e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:i,type:"POST",success:function(){o.hide(),t.unblock()}})}return!1}},bulk_actions:{check_column:function(){e(this).is(":checked")?e("#woocommerce-order-items").find(".check-column input").attr("checked","checked"):e("#woocommerce-order-items").find(".check-column input").removeAttr("checked")},do_bulk_action:function(){var o=e(this).closest(".bulk-actions").find("select").val(),i=e("#woocommerce-order-items").find(".check-column input:checked"),n=[];return e(i).each(function(){var o=e(this).closest("tr");o.attr("data-order_item_id")&&n.push(o.attr("data-order_item_id"))}),0===n.length?void window.alert(woocommerce_admin_meta_boxes.i18n_select_items):(t.bulk_actions[o]&&t.bulk_actions[o](i,n),!1)},"delete":function(o,i){if(window.confirm(woocommerce_admin_meta_boxes.remove_item_notice)){t.block();var n={order_item_ids:i,action:"woocommerce_remove_order_item",security:woocommerce_admin_meta_boxes.order_item_nonce};e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:n,type:"POST",success:function(){e(o).each(function(){e(this).closest("tr").remove()}),t.unblock()}})}},increase_stock:function(o,i){t.block();var n={};e(o).each(function(){var o=e(this).closest("tr.item, tr.fee"),t=o.find("input.quantity");n[o.attr("data-order_item_id")]=t.val()});var a={order_id:woocommerce_admin_meta_boxes.post_id,order_item_ids:i,order_item_qty:n,action:"woocommerce_increase_order_item_stock",security:woocommerce_admin_meta_boxes.order_item_nonce};e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:a,type:"POST",success:function(e){window.alert(e),t.unblock()}})},reduce_stock:function(o,i){t.block();var n={};e(o).each(function(){var o=e(this).closest("tr.item, tr.fee"),t=o.find("input.quantity");n[o.attr("data-order_item_id")]=t.val()});var a={order_id:woocommerce_admin_meta_boxes.post_id,order_item_ids:i,order_item_qty:n,action:"woocommerce_reduce_order_item_stock",security:woocommerce_admin_meta_boxes.order_item_nonce};e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:a,type:"POST",success:function(e){window.alert(e),t.unblock()}})}},backbone:{init:function(o,t){"#wc-modal-add-products"===t&&e("body").trigger("wc-enhanced-select-init")},response:function(e,o,i){if("#wc-modal-add-tax"===o){var n=i.add_order_tax,a="";i.manual_tax_rate_id&&(a=i.manual_tax_rate_id),t.backbone.add_tax(n,a)}"#wc-modal-add-products"===o&&t.backbone.add_item(i.add_order_items)},add_item:function(i){if(i=i.split(",")){var n=i.length;t.block(),e.each(i,function(i,a){var c={action:"woocommerce_add_order_item",item_to_add:a,order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,width:e("#wpti-product-x").val(),height:e("#wpti-product-y").val()};e.post(woocommerce_admin_meta_boxes.ajax_url,c,function(i){e("table.woocommerce_order_items tbody#order_line_items").append(i),--n||(o.init_tiptip(),t.unblock())})})}},add_tax:function(i,n){if(n&&(i=n),!i)return!1;var a=e(".order-tax-id").map(function(){return e(this).val()}).get();if(-1===e.inArray(i,a)){t.block();var c={action:"woocommerce_add_order_tax",rate_id:i,order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce};e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:c,type:"POST",success:function(i){e("#woocommerce-order-items .inside").empty(),e("#woocommerce-order-items .inside").append(i),o.init_tiptip(),t.unblock(),t.stupidtable.init()}})}else window.alert(woocommerce_admin_meta_boxes.i18n_tax_rate_already_exists)}},stupidtable:{init:function(){e(".woocommerce_order_items").stupidtable().on("aftertablesort",this.add_arrows)},add_arrows:function(o,t){var i=e(this).find("th"),n="asc"===t.direction?"&uarr;":"&darr;",a=t.column;a>1&&(a-=1),i.find(".wc-arrow").remove(),i.eq(a).append('<span class="wc-arrow">'+n+"</span>")}}},i={init:function(){e("#woocommerce-order-notes").on("click","a.add_note",this.add_order_note).on("click","a.delete_note",this.delete_order_note)},add_order_note:function(){if(e("textarea#add_order_note").val()){e("#woocommerce-order-notes").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var o={action:"woocommerce_add_order_note",post_id:woocommerce_admin_meta_boxes.post_id,note:e("textarea#add_order_note").val(),note_type:e("select#order_note_type").val(),security:woocommerce_admin_meta_boxes.add_order_note_nonce};return e.post(woocommerce_admin_meta_boxes.ajax_url,o,function(o){e("ul.order_notes").prepend(o),e("#woocommerce-order-notes").unblock(),e("#add_order_note").val("")}),!1}},delete_order_note:function(){var o=e(this).closest("li.note");e(o).block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var t={action:"woocommerce_delete_order_note",note_id:e(o).attr("rel"),security:woocommerce_admin_meta_boxes.delete_order_note_nonce};return e.post(woocommerce_admin_meta_boxes.ajax_url,t,function(){e(o).remove()}),!1}},n={init:function(){e(".order_download_permissions").on("click","button.grant_access",this.grant_access).on("click","button.revoke_access",this.revoke_access)},grant_access:function(){var o=e("#grant_access_id").val();if(o){e(".order_download_permissions").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var t={action:"woocommerce_grant_access_to_download",product_ids:o,loop:e(".order_download_permissions .wc-metabox").size(),order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.grant_access_nonce};return e.post(woocommerce_admin_meta_boxes.ajax_url,t,function(o){o?e(".order_download_permissions .wc-metaboxes").append(o):window.alert(woocommerce_admin_meta_boxes.i18n_download_permission_fail),e("body").trigger("wc-init-datepickers"),e("#grant_access_id").val("").change(),e(".order_download_permissions").unblock()}),!1}},revoke_access:function(){if(window.confirm(woocommerce_admin_meta_boxes.i18n_permission_revoke)){var o=e(this).parent().parent(),t=e(this).attr("rel").split(",")[0],i=e(this).attr("rel").split(",")[1];if(t>0){e(o).block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var n={action:"woocommerce_revoke_access_to_download",product_id:t,download_id:i,order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.revoke_access_nonce};e.post(woocommerce_admin_meta_boxes.ajax_url,n,function(){e(o).fadeOut("300",function(){e(o).remove()})})}else e(o).fadeOut("300",function(){e(o).remove()})}return!1}};o.init(),t.init(),i.init(),n.init()});